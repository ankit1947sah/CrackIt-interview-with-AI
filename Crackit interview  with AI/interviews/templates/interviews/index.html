{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crackit Interview with AI | Crack interview with Confidence</title>
    <!-- CSRF Token for AJAX -->
    <meta name="csrf-token" content="{{ csrf_token }}">

    <script>
        // CRITICAL FIX: Prevent User from opening file directly
        if (window.location.protocol === 'file:') {
            alert("‚ö†Ô∏è STOP! You are opening the file incorrectly.\n\nThe AI features require a SERVER to work.\n\nClick OK to be redirected to the correct URL: http://127.0.0.1:8000");
            window.location.href = "http://127.0.0.1:8000";
        }
    </script>
    <meta name="description"
        content="Master your tech interviews with AI-driven analysis, mock interviews, and placement practice.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --glass: rgba(30, 41, 59, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        .brand {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Canvas Background */
        #bgCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        /* Utilities */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.75rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: rgba(59, 130, 246, 0.1);
            color: white;
            border-color: var(--accent);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Navbar */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1rem 0;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a:not(.btn) {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:not(.btn):hover {
            color: var(--primary);
        }

        /* Hero */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding-top: 100px;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .hero h1 span {
            color: var(--accent);
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto 2.5rem;
        }

        /* Demo Area */
        .demo-wrapper {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .demo-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 0.5rem 1rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: var(--primary);
            border-color: var(--primary);
        }

        .demo-area {
            text-align: center;
            background: black;
            border-radius: 16px;
            padding: 1rem;
            min-height: 400px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent);
            animation: scan 2s infinite linear;
            display: none;
            z-index: 2;
        }

        @keyframes scan {
            0% {
                top: 0;
            }

            100% {
                top: 100%;
            }
        }

        /* Analysis Report */
        .analysis-overlay {
            background: rgba(15, 23, 42, 0.95);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            text-align: left;
            display: none;
            overflow-y: auto;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
        }

        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 6px solid var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .rec-list {
            list-style: none;
            margin-top: 1rem;
        }

        .rec-list li {
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
        }

        .rec-list li::before {
            content: 'üí°';
            position: absolute;
            left: 0;
        }

        /* Features & Grid */
        section {
            padding: 5rem 0;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .card {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        /* Practice Card Specifics */
        .practice-card {
            cursor: pointer;
            position: relative;
            overflow: hidden;
            height: fit-content;
            max-height: 180px;
            /* Moderate size */
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.3s;
        }

        .practice-card.expanded {
            max-height: 2000px;
            /* Large enough to show all content */
            cursor: default;
        }

        .practice-card .question-list {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            margin-top: 1.5rem;
        }

        .practice-card.expanded .question-list {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .practice-card .expand-hint {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 600;
            opacity: 1;
            transition: opacity 0.3s;
        }

        .practice-card.expanded .expand-hint {
            opacity: 0;
            pointer-events: none;
        }

        .icon-box {
            width: 50px;
            height: 50px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        /* Questions Accordion */
        .question-box {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .question-header {
            padding: 1rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.02);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            gap: 1rem;
        }

        .download-chapter-btn {
            padding: 0.3rem 0.6rem;
            font-size: 0.9rem;
            color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-chapter-btn:hover {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .question-body {
            padding: 1rem;
            display: none;
            color: var(--text-muted);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .question-box.open .question-body {
            display: block;
        }

        /* PYQ List Styling */
        .pyq-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .pyq-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            margin-bottom: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .pyq-list li:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .pyq-list a {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.3rem 0.8rem;
            border: 1px solid var(--primary);
            border-radius: 20px;
            transition: all 0.3s;
        }

        .pyq-list a:hover {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 10px var(--primary);
        }

        /* News List */
        .news-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .news-date {
            color: var(--accent);
            font-size: 0.8rem;
            white-space: nowrap;
        }

        /* Modal */
        .modal-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-card);
            width: 90%;
            max-width: 800px;
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 1.5rem;
        }

        .avatar {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
        }

        .profile-info h2 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
        }

        .profile-info p {
            color: var(--text-muted);
        }

        .progress-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .chart-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .circular-chart {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 75%, rgba(255, 255, 255, 0.05) 0);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            position: relative;
        }

        .circular-chart::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background: var(--bg-card);
            border-radius: 50%;
        }

        .circular-chart span {
            position: absolute;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .bar-container {
            margin-bottom: 1rem;
            width: 100%;
        }

        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
        }

        .bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        /* Toast */
        #toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-card);
            padding: 1rem 2rem;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--primary);
            transform: translateY(150px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        #toast.show {
            transform: translateY(0);
        }

        /* Footer */
        footer {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding: 3rem 0;
            margin-top: 5rem;
            text-align: center;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }

            .nav-links {
                display: none;
            }

            .progress-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <canvas id="bgCanvas"></canvas>

    <!-- Toast Notification -->
    <div id="toast">
        <span style="font-size: 1.2rem;">üöÄ</span>
        <span id="toastMsg">Notification</span>
    </div>

    <!-- Profile Modal -->
    {% if user.is_authenticated %}
    <div class="modal-mask" id="profileModal">
        <div class="modal-content">
            <button class="close-modal" onclick="toggleProfile()">√ó</button>
            <div class="profile-header">
                <div class="avatar">{{ user.username|make_list|first|upper }}</div>
                <div class="profile-info">
                    <h2>{{ user.username }}'s Profile</h2>
                    <p>Aspiring AI Engineer ‚Ä¢ Level 5 Interviewer</p>
                    <div style="margin-top: 0.5rem;">
                        <span class="badge"
                            style="background: rgba(16, 185, 129, 0.1); color: var(--success);">Verified</span>
                        <span class="badge">Pro Member</span>
                    </div>
                </div>
            </div>
            <div class="progress-grid">
                <div class="chart-box">
                    <h3>Overall Readiness</h3>
                    <div class="circular-chart"><span>75%</span></div>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">You are almost ready for your dream job!</p>
                </div>
                <div>
                    <h3 style="margin-bottom: 1rem;">Chapter Progress</h3>
                    <div class="bar-container">
                        <div class="bar-label"><span>Aptitude & Logic</span> <span>80%</span></div>
                        <div class="bar-bg">
                            <div class="bar-fill" style="width: 80%; background: var(--accent);"></div>
                        </div>
                    </div>
                    <div class="bar-container">
                        <div class="bar-label"><span>Technical (DSA)</span> <span>60%</span></div>
                        <div class="bar-bg">
                            <div class="bar-fill" style="width: 60%; background: var(--primary);"></div>
                        </div>
                    </div>
                    <div class="bar-container">
                        <div class="bar-label"><span>HR & Behavioral</span> <span>90%</span></div>
                        <div class="bar-bg">
                            <div class="bar-fill" style="width: 90%; background: var(--secondary);"></div>
                        </div>
                    </div>
                    <h3 style="margin: 1.5rem 0 1rem;">Recent Activity</h3>
                    <ul style="list-style: none; color: var(--text-muted); font-size: 0.9rem;">
                        <li style="margin-bottom: 0.5rem;">‚úÖ Completed "Train Speed Problem" (Aptitude)</li>
                        <li style="margin-bottom: 0.5rem;">‚úÖ Scored 85% in Voice Analysis Demo</li>
                        <li>üì• Downloaded Technical Question Bank</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <nav>
        <div class="container nav-content">
            <div class="brand">Crackit interview with AI
            </div>
            <ul class="nav-links">
                <li><a href="#demo">Demo</a></li>
                <li><a href="#practice">Practice</a></li>
                <li><a href="#news">News</a></li>
                {% if user.is_authenticated %}
                <li style="display: flex; align-items: center; gap: 1rem;">
                    <button class="btn btn-outline" style="padding: 0.5rem 1.2rem;" onclick="toggleProfile()">
                        üë§ <span style="margin-left:5px;">{{ user.username }}</span>
                    </button>
                    <form action="{% url 'logout' %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline"
                            style="border:none; color:var(--text-muted); padding: 0.5rem;">Logout</button>
                    </form>
                </li>
                {% else %}
                <li><a href="{% url 'login' %}" class="btn btn-outline" style="padding: 0.5rem 1.2rem;">Login</a></li>
                <li><a href="{% url 'signup' %}" class="btn btn-primary" style="padding: 0.5rem 1.2rem;">Sign Up</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <header class="hero container" id="demo">
        <div style="width: 100%;">
            <h1>The Ultimate AI <br><span>Interview Dashboard</span></h1>
            <p>Live interviews, real-time voice analysis, and instant feedback.</p>
            <div class="demo-wrapper">
                <div class="demo-tabs">
                    <button class="tab-btn active" onclick="setMode('live')">üé• Live Interview</button>
                    <button class="tab-btn" onclick="setMode('record')">üéôÔ∏è Record & Analyze</button>
                </div>

                <!-- Role Selector -->
                <div style="text-align:center; margin-bottom:1rem;" id="roleSelectorContainer">
                    <label style="color:var(--text-muted); margin-right:10px;">Select Role:</label>
                    <select id="roleSelect"
                        style="padding:0.5rem; border-radius:8px; background:rgba(0,0,0,0.3); color:white; border:1px solid var(--primary);">
                        <option value="Full Stack Developer">Full Stack Developer</option>
                        <option value="Data Scientist">Data Scientist</option>
                        <option value="AI Engineer">AI Engineer</option>
                        <option value="Backend Developer">Backend Developer</option>
                        <option value="Frontend Developer">Frontend Developer</option>
                    </select>
                </div>
                <div class="demo-area" id="cameraPreview">
                    <p id="camText" style="color: var(--text-muted); z-index: 1;">
                        Select a mode and click 'Start' to begin.<br>
                        <small>Allow camera/mic access when prompted.</small>
                    </p>
                    <video id="videoElement" autoplay playsinline></video>
                    <div class="scan-line" id="scanLine"></div>
                    <div id="recordingUI"
                        style="display:none; position:absolute; bottom:20px; left:50%; transform:translateX(-50%); z-index:5;">
                        <div
                            style="background:red; width:12px; height:12px; border-radius:50%; display:inline-block; margin-right:8px; animation:blink 1s infinite;">
                        </div>
                        <span style="color:white; font-weight:bold;" id="timerDisplay">REC 00:00</span>
                    </div>
                    <div class="analysis-overlay" id="analysisReport">
                        <div class="analysis-header">
                            <h2>Analysis Report</h2>
                            <button class="btn btn-outline" style="padding:0.3rem 0.8rem; font-size:0.8rem;"
                                onclick="closeReport()">Close</button>
                        </div>
                        <div style="display:flex; align-items:center; gap:2rem; margin-bottom:2rem;">
                            <div style="text-align:center;">
                                <div class="score-circle" id="rptConfidence">--</div>
                                <small>Confidence</small>
                            </div>
                            <div style="flex:1;">
                                <div class="stat-row"><span>Clarity</span> <span style="color:var(--success);"
                                        id="rptClarity">--</span></div>
                                <div class="stat-row"><span>Pace</span> <span id="rptPace">--</span></div>
                                <div class="stat-row"><span>Tone</span> <span id="rptTone">--</span></div>
                                <div
                                    style="background:rgba(255,255,255,0.1); height:6px; border-radius:3px; margin-top:5px;">
                                    <div style="width:0%; background:var(--success); height:100%; border-radius:3px; transition: width 1s;"
                                        id="rptBar"></div>
                                </div>
                            </div>
                        </div>
                        <h3>Recommendations</h3>
                        <ul class="rec-list" id="rptRecs">
                            <li>Analysis pending...</li>
                        </ul>
                    </div>
                </div>
                <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-primary" onclick="startSession()" id="startBtn">Start Live Session</button>
                    <button class="btn btn-outline" onclick="stopCamera()" id="stopBtn" disabled>Stop Recording</button>
                    <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" disabled
                        style="display:none; background-color: var(--success); border-color: var(--success);">Next
                        Question ‚û°</button>
                    <button class="btn btn-outline" onclick="finishSession()" id="finishBtn" disabled
                        style="border-color: var(--accent); color: var(--accent);">Finish & View Report</button>
                    <button class="btn btn-outline" onclick="stopCameraAccess()" id="stopCamAccessBtn"
                        style="border-color: #ef4444; color: #ef4444; display: none;">Stop Camera Access</button>
                </div>
            </div>
        </div>
    </header>

    <section id="practice" class="container">
        <h2 class="section-title">Placement Practice</h2>
        <div class="grid">
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üßÆ Aptitude</h3>
                    <button class="btn btn-outline" style="padding:0.3rem 0.8rem; font-size:0.8rem;"
                        onclick="event.stopPropagation(); downloadKit('Aptitude')">üì• PDF</button>
                </div>
                <p style="margin-bottom:1rem; font-size:0.9rem;">Logic, Math, and Quant.</p>
                <div class="expand-hint">Click to View Chapters ‚Üì</div>
                <div class="question-list">
                    <ul class="pyq-list">
                        <li>1. Train Speed Problem <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>2. Time & Work <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>3. Probability <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>4. Percentages <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>5. Profit & Loss <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>6. Simple Interest <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>7. Ratio & Proportion <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>8. Problems on Ages <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>9. Number System <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>10. Average <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                    </ul>
                </div>
            </div>
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üíª Technical</h3>
                    <button class="btn btn-outline" style="padding:0.3rem 0.8rem; font-size:0.8rem;"
                        onclick="event.stopPropagation(); downloadKit('Technical')">üì• PDF</button>
                </div>
                <p style="margin-bottom:1rem; font-size:0.9rem;">DSA, System Design, OOP.</p>
                <div class="expand-hint">Click to View Chapters ‚Üì</div>
                <div class="question-list">
                    <ul class="pyq-list">
                        <li>1. Reverse a Linked List <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>2. REST vs GraphQL <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>3. Two Sum Problem <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>4. Palindrome Check <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>5. SQL Joins <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>6. OOP Principles <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>7. Garbage Collection <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>8. Binary Search <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>9. Deadlocks <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>10. HTTP Status Codes <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>ü§ù HR Round</h3>
                    <button class="btn btn-outline" style="padding:0.3rem 0.8rem; font-size:0.8rem;"
                        onclick="event.stopPropagation(); downloadKit('HR')">üì• PDF</button>
                </div>
                <p style="margin-bottom:1rem; font-size:0.9rem;">Behavioral & Situational.</p>
                <div class="expand-hint">Click to View Chapters ‚Üì</div>
                <div class="question-list">
                    <ul class="pyq-list">
                        <li>1. Tell me about yourself. <a href="#" download
                                onclick="event.stopPropagation()">Download</a></li>
                        <li>2. Strengths & Weaknesses <a href="#" download
                                onclick="event.stopPropagation()">Download</a></li>
                        <li>3. Conflict Resolution <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>4. Why should we hire you? <a href="#" download
                                onclick="event.stopPropagation()">Download</a></li>
                        <li>5. Five-Year Plan <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>6. Handling Pressure <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>7. Greatest Achievement <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>8. Salary Expectations <a href="#" download onclick="event.stopPropagation()">Download</a>
                        </li>
                        <li>9. Company Research <a href="#" download onclick="event.stopPropagation()">Download</a></li>
                        <li>10. Ideal Work Environment <a href="#" download
                                onclick="event.stopPropagation()">Download</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <h3 class="section-title" style="font-size:1.8rem; margin-top:4rem; margin-bottom:2rem;">Company-Specific PYQs
        </h3>
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
            <!-- TCS Card -->
            <!-- TCS Card -->
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üè¢ TCS</h3>
                    <span class="badge" style="font-size:0.7rem;">Ninja/Digital</span>
                </div>

                <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:1rem;">
                    TCS PYQ Question
                </p>

                <div class="expand-hint">View PYQs ‚Üì</div>

                <div class="question-list">
                    <ul class="pyq-list">
                        <li>
                            TCS PYQ
                            <a href="{% static 'interviews/pyq/tcs_pyq_2022.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            TCS PYQ
                            <a href="{% static 'interviews/pyq/tcs_pyq_2023.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            TCS PYQ
                            <a href="{% static 'interviews/pyq/tcs_practice.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>


            <!-- Infosys Card -->
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üè¢ Infosys</h3>
                    <span class="badge" style="font-size:0.7rem;">DSE/PP</span>
                </div>

                <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:1rem;">
                    Infosys PYQ Question
                </p>

                <div class="expand-hint">View PYQs ‚Üì</div>

                <div class="question-list">
                    <ul class="pyq-list">
                        <li>
                            Infosys PYQ
                            <a href="{% static 'interviews/pyq/infosys_pyq_1.pdf' %}" download class="download-btn"
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Infosys PYQ
                            <a href="{% static 'interviews/pyq/infosys_pyq_2.pdf' %}" download class="download-btn"
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Infosys PYQ
                            <a href="{% static 'interviews/pyq/infosys_class_notes.pdf' %}" download
                                class="download-btn" onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Deloitte Card -->
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üè¢ Deloitte</h3>
                    <span class="badge" style="font-size:0.7rem;">Consulting</span>
                </div>

                <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:1rem;">
                    Deloitte PYQ Question
                </p>

                <div class="expand-hint">View PYQs ‚Üì</div>

                <div class="question-list">
                    <ul class="pyq-list">
                        <li>
                            Deloitte PYQ
                            <a href="{% static 'interviews/pyq/deloitte_pyq_1.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Deloitte PYQ
                            <a href="{% static 'interviews/pyq/deloitte_pyq_2.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Deloitte PYQ
                            <a href="{% static 'interviews/pyq/deloitte_practice.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Accenture Card -->
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üè¢ Accenture</h3>
                    <span class="badge" style="font-size:0.7rem;">ASE/FADA</span>
                </div>

                <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:1rem;">
                    Accenture PYQ Question
                </p>

                <div class="expand-hint">View PYQs ‚Üì</div>

                <div class="question-list">
                    <ul class="pyq-list">
                        <li>
                            Accenture PYQ
                            <a href="{% static 'interviews/pyq/accenture_pyq_1.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Accenture PYQ
                            <a href="{% static 'interviews/pyq/accenture_pyq_2.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Accenture pyq
                            <a href="{% static 'interviews/pyq/accenture_pyq_3.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>


            <!-- IBM Card -->
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üè¢ IBM</h3>
                    <span class="badge" style="font-size:0.7rem;">Associate</span>
                </div>

                <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:1rem;">
                    IBM PYQ Question
                </p>

                <div class="expand-hint">View PYQs ‚Üì</div>

                <div class="question-list">
                    <ul class="pyq-list">
                        <li>
                            IBM PYQ
                            <a href="{% static 'interviews/pyq/ibm_pyq_1.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            IBM PYQ
                            <a href="{% static 'interviews/pyq/ibm_pyq_2.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            IBM PYQ
                            <a href="{% static 'interviews/pyq/ibm_pyq_3.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>


            <!-- Google Card -->
            <div class="card practice-card" onclick="togglePracticeCard(this)">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <h3>üè¢ Google</h3>
                    <span class="badge" style="font-size:0.7rem;">SDE-1/2</span>
                </div>

                <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:1rem;">
                    Google PYQ Question
                </p>

                <div class="expand-hint">View PYQs ‚Üì</div>

                <div class="question-list">
                    <ul class="pyq-list">
                        <li>
                            Google PYQ
                            <a href="{% static 'interviews/pyq/google_pyq_2022.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Google PYQ
                            <a href="{% static 'interviews/pyq/google_pyq_2023.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>

                        <li>
                            Google PYQ
                            <a href="{% static 'interviews/pyq/google_practice.pdf' %}" download
                                onclick="event.stopPropagation()">Download</a>
                        </li>
                    </ul>
                </div>
            </div>


    </section>

    <section id="news" class="container">
        <h2 class="section-title">Latest & Greatest</h2>
        <div class="grid">
            <div class="card" style="grid-column: span 2;">
                <h3>üì∞ AI & Tech News</h3>
                <div class="news-item">
                    <span class="news-date">Today</span>
                    <div><strong>GPT-5 Rumors:</strong> Industry insiders suggest a mid-2026 release with enhanced
                        reasoning capabilities.</div>
                </div>
                <div class="news-item">
                    <span class="news-date">Yesterday</span>
                    <div><strong>React 19 Alpha:</strong> New hook patterns revealed for simpler state management.</div>
                </div>
                <div class="news-item">
                    <span class="news-date">2 days ago</span>
                    <div><strong>Tech Hiring Surge:</strong> Remote dev jobs up by 15% in Q1 2026.</div>
                </div>
            </div>
            <div class="card">
                <h3>üíº Hot Jobs</h3>
                <ul style="list-style:none;">
                    <li style="margin-bottom:1rem;">
                        <div style="font-weight:bold; color:var(--primary);">Senior AI Engineer</div>
                        <div style="font-size:0.8rem;">Google ‚Ä¢ Remote ‚Ä¢ $180k+</div>
                    </li>
                    <li style="margin-bottom:1rem;">
                        <div style="font-weight:bold; color:var(--secondary);">Frontend Lead</div>
                        <div style="font-size:0.8rem;">Netflix ‚Ä¢ Delhi ‚Ä¢ $220k+</div>
                    </li>
                    <li style="margin-bottom:1rem;">
                        <div style="font-weight:bold; color:var(--accent);">Data Scientist</div>
                        <div style="font-size:0.8rem;">Spotify ‚Ä¢ Bengaluru ‚Ä¢ $160k+</div>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <section id="community" class="container">
        <h2 class="section-title">Development Community</h2>
        <div class="grid">
            <a href="{% url 'community_detail' 'web-developers' %}" class="card"
                style="text-decoration:none; color:inherit; display:block;">
                <span class="badge" style="background:rgba(59, 130, 246, 0.2); color:var(--primary);">2.4k Online</span>
                <h3 style="margin:1rem 0;">Web Developers</h3>
                <p>Discuss HTML, CSSReact, Node.js and modern CSS.</p>
                <div style="margin-top:1rem; font-size:0.8rem; color:var(--text-muted);">Top Topic: "Is Tailwind
                    actually good?"</div>
            </a>
            <a href="{% url 'community_detail' 'ai-ml-engineers' %}" class="card"
                style="text-decoration:none; color:inherit; display:block;">
                <span class="badge" style="background:rgba(236, 72, 153, 0.2); color:#ec4899;">1.8k Online</span>
                <h3 style="margin:1rem 0;">AI & ML Engineers</h3>
                <p>Deep Learning, NLP, and model optimization talk.</p>
                <div style="margin-top:1rem; font-size:0.8rem; color:var(--text-muted);">Top Topic: "Optimizing Llama-3
                    locally"</div>
            </a>
            <a href="{% url 'community_detail' 'system-design' %}" class="card"
                style="text-decoration:none; color:inherit; display:block;">
                <span class="badge" style="background:rgba(16, 185, 129, 0.2); color:var(--success);">900 Online</span>
                <h3 style="margin:1rem 0;">System Design</h3>
                <p>Scalability, microservices, and high-level architecture.</p>
                <div style="margin-top:1rem; font-size:0.8rem; color:var(--text-muted);">Top Topic: "Sharding vs
                    Partitioning"</div>
            </a>
        </div>
    </section>

    <footer>
        <div class="container" style="padding:40px 10%; background:#020617; border-top:1px solid #1e293b;">
            <div class="grid"
                style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:30px;">
                <div>
                    <h3>AI Developer The Website</h3>
                    <p>Smart AI-powered interview preparation platform helping you crack placements with confidence.</p>
                </div>
                <div>
                    <h4>Platform</h4>
                    <ul style="list-style:none; margin-top:10px; line-height:1.8; padding:0;">
                        <li>Live AI Interview Practice</li>
                        <li>3-Round Placement Prep</li>
                        <li>Community Discussions</li>
                        <li>User Progress Reports</li>
                    </ul>
                </div>
                <div>
                    <h4>Resources</h4>
                    <ul style="list-style:none; margin-top:10px; line-height:1.8; padding:0;">
                        <li>Latest Tech News</li>
                        <li>Job & Internship Updates</li>
                        <li>Question Banks</li>
                        <li>AI Recommendations</li>
                    </ul>
                </div>
                <div>
                    <h4>Support</h4>
                    <ul style="list-style:none; margin-top:10px; line-height:1.8; padding:0;">
                        <li>Help Center</li>
                        <li>Privacy Policy</li>
                        <li>Terms & Conditions</li>
                        <li>Contact Us</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 40px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                <h5 style="margin-bottom: 20px; color: #fff; text-align: center; font-size: 1.2rem;">We value your
                    feedback</h5>
                <form id="feedbackForm" onsubmit="submitFeedback(event)" style="max-width: 600px; margin: 0 auto;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="fbName" placeholder="Your Name"
                            style="flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #1e293b; background: #020617; color: #fff;"
                            required>
                        <input type="email" id="fbEmail" placeholder="Your Email (Optional)"
                            style="flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #1e293b; background: #020617; color: #fff;">
                    </div>
                    <textarea id="fbMessage" placeholder="Your Feedback" rows="3"
                        style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #1e293b; background: #020617; color: #fff;"
                        required></textarea>
                    <button type="submit" class="btn btn-primary"
                        style="width: 100%; padding: 10px; font-size: 1rem;">Send Feedback</button>
                </form>
            </div>
            <p style="text-align:center; margin-top:40px; color:#94a3b8;">¬© 2026 AI Developer The Website. All rights
                reserved.</p>
        </div>
    </footer>


    <script>
        // Canvas (same as before)
        const canvas = document.getElementById('bgCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const particles = [];
        class Particle {
            constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5; this.size = Math.random() * 2 + 1; }
            update() { this.x += this.vx; this.y += this.vy; if (this.x < 0 || this.x > canvas.width) this.vx *= -1; if (this.y < 0 || this.y > canvas.height) this.vy *= -1; }
            draw() { ctx.fillStyle = 'rgba(59, 130, 246, 0.5)'; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
        }
        for (let i = 0; i < 80; i++)particles.push(new Particle());
        function animateCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                p.update(); p.draw();
                for (let j = i; j < particles.length; j++) {
                    const dx = p.x - particles[j].x; const dy = p.y - particles[j].y; const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) { ctx.strokeStyle = `rgba(59, 130, 246, ${1 - dist / 150})`; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(particles[j].x, particles[j].y); ctx.stroke(); }
                }
            }); requestAnimationFrame(animateCanvas);
        }
        animateCanvas();
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });

        // App Logic
        // let isLoggedIn = false; // Handled by Django now
        let mediaRecorder;
        let recordedChunks = [];
        let streamObj = null;
        let timerInterval;
        let currentQuestionIndex = 0;
        let sessionResults = [];
        let isFinishing = false;
        const TOTAL_QUESTIONS = 20;

        const questionBank = {
            "Full Stack Developer": [
                "Tell me about yourself.",
                "What are your greatest strengths?",
                "Why do we use HTML?",
                "What is the difference between frontend and backend development?",
                "What is the Virtual DOM and how does it work?",
                "Explain the concept of middleware in Node.js.",
                "What is the difference between REST and GraphQL?",
                "Explain CORS and how to handle it.",
                "What is the difference between SQL and NoSQL databases?",
                "How does HTTPS work?",
                "Explain dependency injection.",
                "What is a closure in JavaScript?",
                "Explain the Event Loop in Node.js.",
                "What are the benefits of using Docker?",
                "Microservices vs Monolithic Architecture: Pros and Cons?",
                "Describe your experience with CI/CD pipelines.",
                "Explain your Git workflow.",
                "How would you scale a web application to handle 1 million users?",
                "Describe a challenging bug you fixed.",
                "What is a Promise in JavaScript?"
            ],
            "Data Scientist": [
                "Tell me about yourself.",
                "What is the difference between Supervised and Unsupervised learning?",
                "How do you handle missing data in a dataset?",
                "Explain the Bias-Variance tradeoff.",
                "What is the difference between L1 and L2 regularization?",
                "Explain the concept of Cross-Validation.",
                "What are the assumptions of Linear Regression?",
                "How does a Decision Tree work?",
                "Explain the ROC Curve and AUC.",
                "What is Principal Component Analysis (PCA)?",
                "Difference between Bagging and Boosting.",
                "How do you handle imbalanced datasets?",
                "What is A/B testing?",
                "Explain the difference between Type I and Type II errors.",
                "What is Overfitting and how do you prevent it?",
                "Explain K-Means Clustering.",
                "What is a Confusion Matrix?",
                "Difference between Correlation and Causation.",
                "Explain Gradient Descent.",
                "What libraries do you use for Data Visualization?"
            ],
            "AI Engineer": [
                "Tell me about yourself.",
                "How do you prevent overfitting in a neural network?",
                "What is the difference between RNN and Transformer architectures?",
                "Explain the concept of Transfer Learning.",
                "What is the Vanishing Gradient problem?",
                "Explain the Attention Mechanism.",
                "How does Backpropagation work?",
                "What is Batch Normalization?",
                "Difference between CNN and RNN.",
                "What are Generative Adversarial Networks (GANs)?",
                "Explain Tokenization in NLP.",
                "What is Reinforcement Learning?",
                "How do you optimize hyperparameters?",
                "Explain the difference between Softmax and Sigmoid activation functions.",
                "What is BERT?",
                "How do LLMs (Large Language Models) work?",
                "Explain RAG (Retrieval-Augmented Generation).",
                "What is Model Quantization?",
                "How do you deploy an AI model to production?",
                "Ethical considerations in AI."
            ],
            "Backend Developer": [
                "Tell me about yourself.",
                "Explain the CAP theorem in distributed systems.",
                "How do you handle database migrations safely?",
                "What is the difference between SQL and NoSQL?",
                "Explain the concept of Sharding.",
                "What is ACID compliance?",
                "How do you design an API?",
                "Explain OAuth 2.0 authentication flow.",
                "What is a Reverse Proxy?",
                "How does Caching work (Redism Memcached)?",
                "Difference between Horizontal and Vertical Scaling.",
                "What is a Message Queue (RabbitMQ, Kafka)?",
                "Explain database indexing.",
                "How do you prevent SQL Injection?",
                "What is a WebSocker?",
                "Explain Docker and Kubernetes basics.",
                "What is CI/CD?",
                "How to optimize a slow database query?",
                "Explain Load Balancing.",
                "Microservices communication patterns."
            ],
            "Frontend Developer": [
                "Tell me about yourself.",
                "What are React Hooks and why do we use them?",
                "Explain the browser's critical rendering path.",
                "What is the difference between CSS Flexbox and Grid?",
                "What is Redux/State Management?",
                "Explain Semantic HTML.",
                "How do you optimize website performance?",
                "What is Server-Side Rendering (SSR)?",
                "Explain Event Bubbling and Capturing.",
                "What is the Box Model in CSS?",
                "Difference between `==` and `===` in JS.",
                "What is TypeScript?",
                "Explain Accessible Web Design (A11y).",
                "What are Service Workers?",
                "Difference between LocalStorage, SessionStorage, and Cookies.",
                "How does CSS Specificity work?",
                "What is a Single Page Application (SPA)?",
                "Explain Responsive Design principles.",
                "What is Webpack/Vite?",
                "Describe a project you built."
            ]
        };


        function submitFeedback(event) {
            event.preventDefault();
            const name = document.getElementById('fbName').value;
            const email = document.getElementById('fbEmail').value;
            const message = document.getElementById('fbMessage').value;

            showToast('Sending feedback...');

            const csrfToken = document.querySelector('meta[name="csrf-token"]') ? document.querySelector('meta[name="csrf-token"]').getAttribute('content') : '';

            fetch('/api/feedback/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ name: name, email: email, message: message })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showToast(data.message);
                        document.getElementById('feedbackForm').reset();
                    } else {
                        showToast('Error: ' + (data.message || 'Something went wrong'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('Error sending feedback.');
                });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        /* function handleLogin() { ... Removed for Django Auth ... } */

        function toggleProfile() {
            const modal = document.getElementById('profileModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function downloadKit(type) {
            showToast(`Downloading ${type} Prep Kit...`);

            let content = `Crackit interview with AI - ${type} Prep Kit\n\n`;

            // Find the card for this type
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const title = card.querySelector('h3');
                if (title && title.innerText.includes(type)) {
                    const questions = card.querySelectorAll('.question-box');
                    questions.forEach((q) => {
                        const qTitle = q.querySelector('.question-header span').innerText;
                        const qBody = q.querySelector('.question-body').innerText;
                        content += `${qTitle}\nDetail: ${qBody}\n\n`;
                    });
                }
            });

            content += `---\nMaster your interview with Crackit AI.\nGenerated on: ${new Date().toLocaleDateString()}`;

            const blob = new Blob([content], { type: "text/plain" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}_Prep_Kit.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadChapter(category, chapter) {
            showToast(`Generating ${chapter} Download...`);

            // Extract content from DOM
            const boxes = document.querySelectorAll('.question-box');
            let bodyText = "Content not found.";

            boxes.forEach(box => {
                const header = box.querySelector('.question-header span');
                if (header && header.innerText.includes(chapter)) {
                    const body = box.querySelector('.question-body');
                    if (body) bodyText = body.innerText;
                }
            });

            const content = `Crackit interview with AI - ${category} Round\n\nChapter: ${chapter}\n\nKey Concepts/Details:\n${bodyText}\n\n---\nMaster your interview with Crackit AI.`;

            const blob = new Blob([content], { type: "text/plain" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `${chapter.replace(/\s+/g, '_')}_${category.toLowerCase()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function setMode(mode) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            const txt = document.getElementById('camText');

            // Show/Hide Role Selector based on mode
            const roleSel = document.getElementById('roleSelectorContainer');

            if (mode === 'live') {
                txt.innerHTML = "Live Interview Mode<br><small>AI will ask you questions in real-time.</small>";
                roleSel.style.display = 'block';
            } else {
                txt.innerHTML = "Record & Analyze Mode<br><small>Record your answer and get an instant report.</small>";
                roleSel.style.display = 'none';
            }
        }

        function speakQuestion() {
            const role = document.getElementById('roleSelect').value;
            const questions = questionBank[role] || ["Tell me about yourself.", "What are your strengths?", "Where do you see yourself in 5 years?"];

            // Cycle through questions if we run out
            const qText = questions[currentQuestionIndex % questions.length];
            const question = `Question ${currentQuestionIndex + 1}: ${qText}`;

            showToast(question);

            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(qText);
                utterance.pitch = 1;
                utterance.rate = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function startTimer() {
            let seconds = 0;
            const display = document.getElementById('timerDisplay');
            display.innerText = "REC 00:00";

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                display.innerText = `REC ${mins}:${secs}`;
            }, 1000);
        }

        function startSession() {
            const startBtn = document.getElementById('startBtn');
            const role = document.getElementById('roleSelect').value;

            // 1. Initialize Session State
            currentQuestionIndex = 0;
            sessionResults = [];
            // Ensure questions exist
            if (!questionBank[role]) questionBank[role] = ["Generic Q1", "Generic Q2", "Generic Q3"];

            // 2. Request Camera PERMISSION ONCE (User Action)
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(function (stream) {
                    streamObj = stream;
                    document.getElementById('videoElement').srcObject = stream;

                    // Setup UI
                    document.getElementById('videoElement').style.display = 'block';
                    document.getElementById('camText').style.display = 'none';
                    document.getElementById('scanLine').style.display = 'block';
                    document.getElementById('recordingUI').style.display = 'block';

                    startBtn.style.display = 'none';
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('stopBtn').classList.replace('btn-outline', 'btn-primary');
                    document.getElementById('finishBtn').disabled = true;
                    document.getElementById('stopCamAccessBtn').style.display = 'inline-block';

                    // 3. Start the Loop
                    recordCurrentQuestion();

                }).catch(e => showToast("Camera Access Denied: " + e));
            } else alert("Camera not supported");
        }

        function recordCurrentQuestion() {
            // Logic to record the current question index
            speakQuestion();

            // RE-ENABLE UI (Critical for Q2, Q3...)
            document.getElementById('recordingUI').style.display = 'block';
            document.getElementById('scanLine').style.display = 'block';

            document.getElementById('stopBtn').disabled = false;
            document.getElementById('stopBtn').classList.replace('btn-outline', 'btn-primary');

            document.getElementById('finishBtn').style.display = 'inline-block';
            document.getElementById('finishBtn').disabled = false; // Allow finishing mid-recording if needed? Or keep disabled?
            // Actually, usually finish is for "between" questions. 
            // If recording, we usually want "Stop" first. 
            // But let's keep finish enabled to be safe, or disabled?
            // User requested finish button always appear.

            document.getElementById('nextBtn').style.display = 'none';

            // Init Recorder with EXISTING stream
            recordedChunks = [];
            try {
                mediaRecorder = new MediaRecorder(streamObj);
            } catch (err) {
                console.error("Recorder Error:", err);
                showToast("Recorder Error. Please refresh.");
                return;
            }

            mediaRecorder.ondataavailable = event => {
                if (event.data.size > 0) recordedChunks.push(event.data);
            };
            mediaRecorder.start();

            startTimer();
        }

        function stopCamera() {
            clearInterval(timerInterval);
            console.log("Stopping camera...");

            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                // Force flush of data
                mediaRecorder.requestData();
                mediaRecorder.stop();

                mediaRecorder.onstop = () => {
                    console.log("Recorder stopped. Chunks:", recordedChunks.length);
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    console.log("Blob size:", blob.size);

                    if (blob.size === 0) {
                        showToast("Error: 0 bytes recorded. Mic blocked?");
                        return;
                    }
                    sendToBackend(blob);
                };
            } else {
                showToast("Recorder was not active.");
            }
            // Do NOT stop streamObj tracks here, we need them for next question

            // UI updates
            document.getElementById('recordingUI').style.display = 'none';
            document.getElementById('scanLine').style.display = 'none';

            // Wait for processing...
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('finishBtn').disabled = true;
            document.getElementById('startBtn').innerText = "Processing...";
        }

        function finishSession() {
            if (sessionResults.length > 0) {
                stopCamera();
                // If we are recording, stopCamera will trigger onstop which processes the last chunk...
                // But if we are in "Waiting for Next" state, we just show report.
                if (mediaRecorder && mediaRecorder.state === 'inactive') {
                    generateFinalReport();
                } else {
                    isFinishing = true;
                    mediaRecorder.stop(); // This will trigger onstop -> generateFinalReport
                }
            } else {
                alert("Please record at least one answer.");
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                recordCurrentQuestion();
            } else {
                generateFinalReport();
            }
        }

        function stopCameraAccess() {
            if (streamObj) streamObj.getTracks().forEach(t => t.stop());
            document.getElementById('videoElement').style.display = 'none';
            document.getElementById('camText').style.display = 'block';
            document.getElementById('camText').innerHTML = "Camera Access Stopped.<br><small>Refresh to start again.</small>";
            document.getElementById('recordingUI').style.display = 'none';
            document.getElementById('scanLine').style.display = 'none';

            // Reset Buttons
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('startBtn').innerText = "Start Live Session";
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('finishBtn').disabled = true;
            document.getElementById('stopCamAccessBtn').style.display = 'none';
        }

        function endSession() {
            stopCameraAccess();
        }


        function sendToBackend(blob) {
            showToast("Processing Answer " + (currentQuestionIndex + 1) + "...");
            const formData = new FormData();
            formData.append('video_file', blob, 'interview.webm');

            const role = document.getElementById('roleSelect').value;
            formData.append('role', role);

            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            fetch('/api/analyze/', {
                method: 'POST',
                headers: { 'X-CSRFToken': csrfToken },
                body: formData
            })
                .then(async response => {
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error || response.statusText);
                    return data;
                })
                .then(data => {
                    sessionResults.push(data);
                    currentQuestionIndex++;

                    document.getElementById('stopBtn').disabled = true;
                    document.getElementById('stopBtn').classList.replace('btn-primary', 'btn-outline');

                    if (isFinishing || currentQuestionIndex >= TOTAL_QUESTIONS) {
                        showToast("Interview Complete! Generating Report...");
                        endSession();
                        generateFinalReport();
                        return;
                    }

                    // Show Next Button Logic
                    document.getElementById('camText').style.display = 'block';
                    document.getElementById('camText').innerHTML = `<b>Answer Recorded!</b><br>Click 'Next Question' to continue.`;

                    const nextBtn = document.getElementById('nextBtn');
                    nextBtn.style.display = 'inline-block';
                    nextBtn.disabled = false;

                    document.getElementById('finishBtn').disabled = false;
                    showToast("Answer Saved. Click Next.");
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast("Analysis Failed: " + error.message);
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('startBtn').innerText = "Retry";
                });
        }

        function generateFinalReport() {
            console.log("Generating Report with results:", sessionResults);

            // Safety check
            if (sessionResults.length === 0) {
                alert("No answers recorded yet!");
                closeReport();
                return;
            }

            // Aggregate Data
            let totalConf = 0;
            let totalPace = 0;
            let allRecs = [];

            sessionResults.forEach(res => {
                totalConf += (res.confidence || 0);
                const p = parseInt(res.pace) || 0;
                totalPace += p;

                if (Array.isArray(res.recommendations)) {
                    allRecs = allRecs.concat(res.recommendations);
                }
            });

            // Avoid division by zero
            const count = sessionResults.length;
            const avgConf = Math.round(totalConf / count);
            const avgPace = Math.round(totalPace / count);

            // Update UI
            document.getElementById('rptConfidence').innerText = avgConf + '%';
            document.getElementById('rptClarity').innerText = avgConf > 80 ? 'High' : 'Medium';
            document.getElementById('rptPace').innerText = avgPace + ' wpm';
            document.getElementById('rptTone').innerText = 'Professional';
            document.getElementById('rptBar').style.width = avgConf + '%';

            const recList = document.getElementById('rptRecs');
            recList.innerHTML = '';

            // Show top 5 unique recommendations
            const uniqueRecs = [...new Set(allRecs)].slice(0, 5);
            uniqueRecs.forEach(r => {
                const li = document.createElement('li');
                li.innerText = r;
                recList.appendChild(li);
            });

            // Add Summary Note
            const summary = document.createElement('li');
            summary.innerHTML = `<b>Summary:</b> You completed ${sessionResults.length} questions with an average confidence of ${avgConf}%.`;
            summary.style.color = 'var(--accent)';
            recList.prepend(summary);

            document.getElementById('analysisReport').style.display = 'flex';

            // Reset for new session
            currentQuestionIndex = 0;
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('startBtn').innerText = "Start New Session";
            document.getElementById('startBtn').disabled = false;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('finishBtn').style.display = 'none';
            document.getElementById('stopBtn').classList.replace('btn-primary', 'btn-outline');
        }

        function closeReport() {
            document.getElementById('analysisReport').style.display = 'none';
            document.getElementById('camText').style.display = 'block';
        }

        function toggleQ(el) {
            if (el.classList.contains('question-header')) {
                el.parentElement.classList.toggle('open');
            } else {
                el.closest('.question-box').classList.toggle('open');
            }
        }

        function togglePracticeCard(card) {
            const isExpanded = card.classList.contains('expanded');

            if (isExpanded) {
                card.classList.remove('expanded');
            } else {
                // Close other expanded cards
                document.querySelectorAll('.practice-card.expanded').forEach(c => {
                    c.classList.remove('expanded');
                });
                card.classList.add('expanded');
            }
        }
    </script>
    <style>
        @keyframes blink {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }
    </style>
</body>

</html>